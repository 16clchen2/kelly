来自 <https://github.com/qjw/kelly> 重构